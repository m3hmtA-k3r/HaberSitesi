@model WebUI.Models.BlogDetayViewModel
@inject Ganss.Xss.HtmlSanitizer HtmlSanitizer

@{
    ViewData["Title"] = Model.Blog.Baslik + " - MASKER Blog";
    ViewData["Description"] = Model.Blog.Ozet ?? (Model.Blog.Icerik.Length > 160 ? Model.Blog.Icerik.Substring(0, 160) + "..." : Model.Blog.Icerik);
    ViewData["Keywords"] = (Model.Blog.KategoriAdi ?? "blog") + ", " + (Model.Blog.Etiketler ?? "yazi, makale");
    ViewData["OgType"] = "article";
    ViewData["OgImage"] = Model.Blog.GorselUrl;
}

<style>
    .blog-detail-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 4rem 0;
        color: #fff;
    }
    .blog-detail-header .container { max-width: 900px; }
    .blog-category-badge {
        display: inline-block;
        padding: 0.4rem 1.2rem;
        background: rgba(255,255,255,0.2);
        border-radius: 20px;
        font-size: 0.9rem;
        margin-bottom: 1rem;
    }
    .blog-detail-title {
        font-size: 2.5rem;
        font-weight: 700;
        line-height: 1.3;
        margin-bottom: 1.5rem;
    }
    .blog-detail-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        align-items: center;
        opacity: 0.9;
    }
    .meta-item { display: flex; align-items: center; gap: 0.5rem; }
    .meta-item i { font-size: 1rem; }
    .author-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid rgba(255,255,255,0.5);
    }

    .blog-content-section {
        padding: 3rem 0;
        background: #f7fafc;
    }
    .blog-content-wrapper {
        max-width: 900px;
        margin: 0 auto;
    }

    .blog-main-image {
        width: 100%;
        border-radius: 20px;
        margin-bottom: 2rem;
        box-shadow: 0 20px 60px rgba(0,0,0,0.15);
    }

    .blog-content-card {
        background: #fff;
        border-radius: 20px;
        padding: 3rem;
        box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
    }

    .blog-content {
        font-size: 1.1rem;
        line-height: 1.9;
        color: #2d3748;
    }
    .blog-content p { margin-bottom: 1.5rem; }
    .blog-content h2, .blog-content h3 {
        margin-top: 2rem;
        margin-bottom: 1rem;
        color: #1a202c;
    }
    .blog-content img {
        max-width: 100%;
        border-radius: 10px;
        margin: 1.5rem 0;
    }
    .blog-content a { color: #667eea; }
    .blog-content blockquote {
        border-left: 4px solid #667eea;
        padding-left: 1.5rem;
        margin: 2rem 0;
        font-style: italic;
        color: #4a5568;
    }
    .blog-content code {
        background: #f0f0f0;
        padding: 0.2rem 0.5rem;
        border-radius: 5px;
        font-family: monospace;
    }
    .blog-content pre {
        background: #2d3748;
        color: #e2e8f0;
        padding: 1.5rem;
        border-radius: 10px;
        overflow-x: auto;
    }

    .blog-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 1px solid #e2e8f0;
    }
    .blog-tag {
        padding: 0.4rem 1rem;
        background: #edf2f7;
        color: #4a5568;
        border-radius: 20px;
        font-size: 0.85rem;
        text-decoration: none;
        transition: all 0.3s;
    }
    .blog-tag:hover {
        background: #667eea;
        color: #fff;
    }

    .share-section {
        background: #fff;
        border-radius: 20px;
        padding: 1.5rem 2rem;
        box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }
    .share-title { font-weight: 700; color: #2d3748; }
    .share-buttons { display: flex; gap: 0.75rem; }
    .share-btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-size: 1rem;
        transition: all 0.3s;
        text-decoration: none;
    }
    .share-btn:hover { transform: translateY(-3px); color: #fff; }
    .share-btn.twitter { background: #1da1f2; }
    .share-btn.facebook { background: #4267b2; }
    .share-btn.linkedin { background: #0077b5; }
    .share-btn.whatsapp { background: #25d366; }

    /* Comments Section */
    .comments-section {
        background: #fff;
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
    }
    .comments-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #f0f0f0;
    }
    .comment-item {
        padding: 1.5rem;
        background: #f7fafc;
        border-radius: 15px;
        margin-bottom: 1rem;
    }
    .comment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
    }
    .comment-author {
        font-weight: 700;
        color: #2d3748;
    }
    .comment-date {
        font-size: 0.85rem;
        color: #a0aec0;
    }
    .comment-content {
        color: #4a5568;
        line-height: 1.6;
    }

    /* Comment Form */
    .comment-form-section {
        background: #fff;
        border-radius: 20px;
        padding: 2rem;
        box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        margin-bottom: 2rem;
    }
    .form-group { margin-bottom: 1.25rem; }
    .form-group label {
        font-weight: 600;
        color: #4a5568;
        margin-bottom: 0.5rem;
        display: block;
    }
    .form-control {
        width: 100%;
        padding: 0.8rem 1rem;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 1rem;
        transition: all 0.3s;
    }
    .form-control:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        outline: none;
    }
    .btn-submit {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: #fff;
        padding: 0.8rem 2rem;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }
    .btn-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    .alert {
        padding: 1rem 1.5rem;
        border-radius: 10px;
        margin-bottom: 1.5rem;
    }
    .alert-success { background: #d4edda; color: #155724; }
    .alert-danger { background: #f8d7da; color: #721c24; }

    /* Related Blogs */
    .related-section {
        padding: 3rem 0;
    }
    .section-title {
        font-size: 1.75rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 2rem;
        text-align: center;
    }
    .related-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
    }
    .related-card {
        background: #fff;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        transition: all 0.3s;
    }
    .related-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0,0,0,0.12);
    }
    .related-card img {
        width: 100%;
        height: 150px;
        object-fit: cover;
    }
    .related-card-content {
        padding: 1.25rem;
    }
    .related-card-title {
        font-size: 1rem;
        font-weight: 700;
        color: #2d3748;
        margin-bottom: 0.5rem;
        line-height: 1.4;
    }
    .related-card-title a {
        color: inherit;
        text-decoration: none;
    }
    .related-card-title a:hover { color: #667eea; }
    .related-card-date {
        font-size: 0.85rem;
        color: #a0aec0;
    }

    .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.6rem 1.5rem;
        background: #fff;
        color: #667eea;
        border: 2px solid #667eea;
        border-radius: 25px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s;
        margin-bottom: 2rem;
    }
    .back-btn:hover {
        background: #667eea;
        color: #fff;
    }
</style>

<!-- Blog Detail Header -->
<div class="blog-detail-header">
    <div class="container">
        @if (!string.IsNullOrEmpty(Model.Blog.KategoriAdi))
        {
            <span class="blog-category-badge">
                <i class="fas fa-folder mr-1"></i>@Model.Blog.KategoriAdi
            </span>
        }
        <h1 class="blog-detail-title">@Model.Blog.Baslik</h1>
        <div class="blog-detail-meta">
            <div class="meta-item">
                @if (!string.IsNullOrEmpty(Model.Blog.YazarResim))
                {
                    <img src="@Model.Blog.YazarResim" alt="@Model.Blog.YazarAdi" class="author-avatar">
                }
                else
                {
                    <i class="fas fa-user-circle" style="font-size: 2rem;"></i>
                }
                <span>@(Model.Blog.YazarAdi ?? "Anonim")</span>
            </div>
            <div class="meta-item">
                <i class="far fa-calendar"></i>
                <span>@Model.Blog.YayinTarihi.ToString("dd MMMM yyyy")</span>
            </div>
            <div class="meta-item">
                <i class="far fa-eye"></i>
                <span>@Model.Blog.GoruntulenmeSayisi goruntulenme</span>
            </div>
            <div class="meta-item">
                <i class="far fa-comments"></i>
                <span>@Model.Yorumlar.Count yorum</span>
            </div>
        </div>
    </div>
</div>

<!-- Blog Content Section -->
<div class="blog-content-section">
    <div class="container blog-content-wrapper">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" style="margin-bottom: 1.5rem;">
            <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList" style="background: #fff; border-radius: 10px; padding: 0.75rem 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); margin: 0; font-size: 0.9rem;">
                <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                    <a href="/" itemprop="item" style="color: #667eea; text-decoration: none;"><i class="fas fa-home mr-1"></i><span itemprop="name">Anasayfa</span></a>
                    <meta itemprop="position" content="1" />
                </li>
                <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
                    <a href="/Blog" itemprop="item" style="color: #667eea; text-decoration: none;"><span itemprop="name">Blog</span></a>
                    <meta itemprop="position" content="2" />
                </li>
                <li class="breadcrumb-item active" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem" aria-current="page">
                    <span itemprop="name" style="color: #764ba2; font-weight: 600;">@(Model.Blog.Baslik.Length > 50 ? Model.Blog.Baslik.Substring(0, 50) + "..." : Model.Blog.Baslik)</span>
                    <meta itemprop="position" content="3" />
                </li>
            </ol>
        </nav>

        <a href="/Blog" class="back-btn">
            <i class="fas fa-arrow-left"></i> Tum Bloglar
        </a>

        @if (!string.IsNullOrEmpty(Model.Blog.GorselUrl))
        {
            <img src="@Model.Blog.GorselUrl" alt="@Model.Blog.Baslik" class="blog-main-image">
        }

        <!-- Blog Content -->
        <div class="blog-content-card">
            <div class="blog-content">
                @Html.Raw(HtmlSanitizer.Sanitize(Model.Blog.Icerik ?? ""))
            </div>

            @if (!string.IsNullOrEmpty(Model.Blog.Etiketler))
            {
                <div class="blog-tags">
                    <i class="fas fa-tags" style="color: #a0aec0; margin-right: 0.5rem;"></i>
                    @foreach (var tag in Model.Blog.Etiketler.Split(','))
                    {
                        <a href="/Blog?tag=@tag.Trim()" class="blog-tag">@tag.Trim()</a>
                    }
                </div>
            }
        </div>

        <!-- Share Section -->
        @{
            var shareUrl = $"{Context.Request.Scheme}://{Context.Request.Host}{Context.Request.Path}";
        }
        <div class="share-section">
            <span class="share-title"><i class="fas fa-share-alt mr-2"></i>Bu yaziyi paylas</span>
            <div class="share-buttons">
                <a href="https://twitter.com/intent/tweet?url=@Uri.EscapeDataString(shareUrl)&text=@Uri.EscapeDataString(Model.Blog.Baslik)" target="_blank" class="share-btn twitter" title="Twitter'da Paylas">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="https://www.facebook.com/sharer/sharer.php?u=@Uri.EscapeDataString(shareUrl)" target="_blank" class="share-btn facebook" title="Facebook'ta Paylas">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="https://www.linkedin.com/shareArticle?mini=true&url=@Uri.EscapeDataString(shareUrl)&title=@Uri.EscapeDataString(Model.Blog.Baslik)" target="_blank" class="share-btn linkedin" title="LinkedIn'de Paylas">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a href="https://wa.me/?text=@Uri.EscapeDataString(Model.Blog.Baslik + " " + shareUrl)" target="_blank" class="share-btn whatsapp" title="WhatsApp'ta Paylas">
                    <i class="fab fa-whatsapp"></i>
                </a>
            </div>
        </div>

        <!-- Comments Section -->
        <div class="comments-section">
            <h3 class="comments-title">
                <i class="fas fa-comments mr-2"></i>Yorumlar (@Model.Yorumlar.Count)
            </h3>

            @if (Model.Yorumlar.Any())
            {
                @foreach (var yorum in Model.Yorumlar.OrderByDescending(y => y.OlusturmaTarihi))
                {
                    <div class="comment-item">
                        <div class="comment-header">
                            <span class="comment-author">
                                <i class="fas fa-user-circle mr-1"></i>@yorum.AdSoyad
                            </span>
                            <span class="comment-date">
                                <i class="far fa-clock mr-1"></i>@yorum.OlusturmaTarihi.ToString("dd MMM yyyy HH:mm")
                            </span>
                        </div>
                        <p class="comment-content">@yorum.Yorum</p>
                    </div>
                }
            }
            else
            {
                <p style="color: #718096; text-align: center; padding: 2rem;">
                    <i class="far fa-comment-dots" style="font-size: 2rem; display: block; margin-bottom: 0.5rem;"></i>
                    Henuz yorum yapilmamis. Ilk yorumu siz yapin!
                </p>
            }
        </div>

        <!-- Comment Form -->
        <div class="comment-form-section">
            <h3 class="comments-title">
                <i class="fas fa-pen mr-2"></i>Yorum Yap
            </h3>

            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success">
                    <i class="fas fa-check-circle mr-2"></i>@TempData["Success"]
                </div>
            }
            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle mr-2"></i>@TempData["Error"]
                </div>
            }

            <form action="/Blog/YorumYap" method="post">
                @Html.AntiForgeryToken()
                <input type="hidden" name="BlogId" value="@Model.Blog.Id" />

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="Ad"><i class="fas fa-user mr-1"></i>Adiniz *</label>
                            <input type="text" class="form-control" id="Ad" name="Ad" required placeholder="Adinizi girin">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="Email"><i class="fas fa-envelope mr-1"></i>E-posta (opsiyonel)</label>
                            <input type="email" class="form-control" id="Email" name="Email" placeholder="ornek@email.com">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="Yorum"><i class="fas fa-comment mr-1"></i>Yorumunuz *</label>
                    <textarea class="form-control" id="Yorum" name="Yorum" rows="4" required placeholder="Yorumunuzu buraya yazin..."></textarea>
                </div>

                <button type="submit" class="btn-submit">
                    <i class="fas fa-paper-plane mr-2"></i>Yorumu Gonder
                </button>
            </form>
        </div>

        <!-- Related Blogs -->
        @if (Model.IlgiliBloglar.Any())
        {
            <div class="related-section">
                <h3 class="section-title">
                    <i class="fas fa-newspaper mr-2"></i>Ilgili Yazilar
                </h3>
                <div class="related-grid">
                    @foreach (var blog in Model.IlgiliBloglar)
                    {
                        <div class="related-card">
                            @if (!string.IsNullOrEmpty(blog.GorselUrl))
                            {
                                <img src="@blog.GorselUrl" alt="@blog.Baslik">
                            }
                            else
                            {
                                <img src="https://via.placeholder.com/300x150/667eea/ffffff?text=Blog" alt="@blog.Baslik">
                            }
                            <div class="related-card-content">
                                <h4 class="related-card-title">
                                    <a href="/Blog/Detay/@blog.Id">@blog.Baslik</a>
                                </h4>
                                <span class="related-card-date">
                                    <i class="far fa-calendar mr-1"></i>@blog.YayinTarihi.ToString("dd MMM yyyy")
                                </span>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>
